<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="date" content="2024-06-02" />

<title>Using DataPackageR</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Using DataPackageR</h1>
<h4 class="date">2024-06-02</h4>


<div id="TOC">
<ul>
<li><a href="#purpose" id="toc-purpose">Purpose</a></li>
<li><a href="#set-up-a-new-data-package." id="toc-set-up-a-new-data-package.">Set up a new data package.</a>
<ul>
<li><a href="#whats-in-the-package-skeleton-structure" id="toc-whats-in-the-package-skeleton-structure">What’s in the package
skeleton structure?</a></li>
<li><a href="#a-note-about-the-yaml-config-file." id="toc-a-note-about-the-yaml-config-file.">A note about the YAML config
file.</a></li>
<li><a href="#where-do-i-put-my-raw-datasets" id="toc-where-do-i-put-my-raw-datasets">Where do I put my raw
datasets?</a></li>
<li><a href="#an-api-to-read-raw-data-sets-from-within-an-r-or-rmd-processing-script." id="toc-an-api-to-read-raw-data-sets-from-within-an-r-or-rmd-processing-script.">An
API to read raw data sets from within an R or Rmd processing
script.</a></li>
<li><a href="#yaml-header-metadata-for-r-files-and-rmd-files." id="toc-yaml-header-metadata-for-r-files-and-rmd-files.">YAML header
metadata for R files and Rmd files.</a></li>
</ul></li>
<li><a href="#build-the-data-package." id="toc-build-the-data-package.">Build the data package.</a>
<ul>
<li><a href="#documenting-your-data-set-changes-in-news." id="toc-documenting-your-data-set-changes-in-news.">Documenting your
data set changes in NEWS.</a></li>
<li><a href="#logging-the-build-process." id="toc-logging-the-build-process.">Logging the build process.</a></li>
<li><a href="#a-note-about-the-package-source-directory-after-building." id="toc-a-note-about-the-package-source-directory-after-building.">A
note about the package source directory after building.</a></li>
<li><a href="#update-the-auto-generated-documentation." id="toc-update-the-auto-generated-documentation.">Update the
auto-generated documentation.</a></li>
<li><a href="#why-not-just-use-r-cmd-build" id="toc-why-not-just-use-r-cmd-build">Why not just use R CMD
build?</a></li>
</ul></li>
<li><a href="#installing-and-using-the-new-data-package." id="toc-installing-and-using-the-new-data-package.">Installing and using
the new data package.</a>
<ul>
<li><a href="#accessing-vignettes-data-sets-and-data-set-documentation." id="toc-accessing-vignettes-data-sets-and-data-set-documentation.">Accessing
vignettes, data sets, and data set documentation.</a></li>
<li><a href="#using-the-dataversion." id="toc-using-the-dataversion.">Using the DataVersion.</a></li>
</ul></li>
<li><a href="#migrating-old-data-packages." id="toc-migrating-old-data-packages.">Migrating old data packages.</a>
<ul>
<li><a href="#create-a-datapackager.yml-file." id="toc-create-a-datapackager.yml-file.">Create a datapackager.yml
file.</a>
<ul>
<li><a href="#reading-data-sets-from-rmd-files." id="toc-reading-data-sets-from-rmd-files.">Reading data sets from Rmd
files.</a></li>
</ul></li>
</ul></li>
<li><a href="#partial-builds." id="toc-partial-builds.">Partial
builds.</a></li>
<li><a href="#multi-script-pipelines." id="toc-multi-script-pipelines.">Multi-script pipelines.</a>
<ul>
<li><a href="#file-system-artifacts." id="toc-file-system-artifacts.">File system artifacts.</a></li>
<li><a href="#passing-data-objects-to-subsequent-scripts." id="toc-passing-data-objects-to-subsequent-scripts.">Passing data
objects to subsequent scripts.</a></li>
</ul></li>
<li><a href="#next-steps." id="toc-next-steps.">Next steps.</a>
<ul>
<li><a href="#place-your-package-under-source-control." id="toc-place-your-package-under-source-control.">Place your package
under source control.</a></li>
</ul></li>
<li><a href="#additional-details." id="toc-additional-details.">Additional Details.</a>
<ul>
<li><a href="#fingerprints-of-stored-data-objects." id="toc-fingerprints-of-stored-data-objects.">Fingerprints of stored
data objects.</a>
<ul>
<li><a href="#datadigest" id="toc-datadigest">DATADIGEST</a></li>
<li><a href="#description" id="toc-description">DESCRIPTION</a></li>
</ul></li>
</ul></li>
</ul>
</div>

<div id="purpose" class="section level2">
<h2>Purpose</h2>
<p>This vignette demonstrates how to use DataPackageR to build a data
package. DataPackageR aims to simplify data package construction. It
provides mechanisms for reproducibly preprocessing and tidying raw data
into into documented, versioned, and packaged analysis-ready data sets.
Long-running or computationally intensive data processing can be
decoupled from the usual <code>R CMD build</code> process while
maintaining <a href="https://en.wikipedia.org/wiki/Data_lineage">data
lineage</a>.</p>
<p>For demonstration purposes, in this vignette we will subset and
package the <code>mtcars</code> data set.</p>
</div>
<div id="set-up-a-new-data-package." class="section level2">
<h2>Set up a new data package.</h2>
<p>We will set up a new data package based on the <code>mtcars</code>
example in the <a href="https://github.com/ropensci/DataPackageR/blob/master/README.md">README</a>.
The <code>datapackage_skeleton()</code> API is used to set up a new
package. The user needs to provide:</p>
<ul>
<li>R or Rmd files that process data.</li>
<li>A list of R object names created by those files.</li>
<li>Optionally, a path to a directory of raw data (will be copied into
the package).</li>
<li>Optionally, a list of additional files that may be dependencies of
your R or Rmd data processing files.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(DataPackageR)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co"># Let&#39;s reproducibly package the cars in the mtcars dataset with speed</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># &gt; 20. Our dataset will be called `cars_over_20`.</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co"># Get the code file that turns the raw data to our packaged and</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co"># processed analysis-ready dataset.</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>processing_code <span class="ot">&lt;-</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;tests&quot;</span>, <span class="st">&quot;subsetCars.Rmd&quot;</span>, <span class="at">package =</span> <span class="st">&quot;DataPackageR&quot;</span>)</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co"># Create the package framework.</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>DataPackageR<span class="sc">::</span><span class="fu">datapackage_skeleton</span>(<span class="at">name =</span> <span class="st">&quot;mtcars20&quot;</span>,</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>                                   <span class="at">force =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>                                   <span class="at">code_files =</span> processing_code,</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>                                   <span class="at">r_object_names =</span> <span class="st">&quot;cars_over_20&quot;</span>,</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>                                   <span class="at">path =</span> <span class="fu">tempdir</span>()</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>                                   <span class="co">#dependencies argument is empty</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>                                   <span class="co">#raw_data_dir argument is empty.</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>                                   )</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>✔ Creating <span class="st">&#39;C:/Users/dslager/AppData/Local/Temp/RtmpQ7KJSR/mtcars20/&#39;</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>✔ Setting active project to <span class="st">&#39;C:/Users/dslager/AppData/Local/Temp/RtmpQ7KJSR/mtcars20&#39;</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>✔ Creating <span class="st">&#39;R/&#39;</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>✔ Writing <span class="st">&#39;DESCRIPTION&#39;</span></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>✔ Writing <span class="st">&#39;NAMESPACE&#39;</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>✔ Setting active project to <span class="st">&#39;&lt;no active project&gt;&#39;</span></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>✔ Setting active project to <span class="st">&#39;C:/Users/dslager/AppData/Local/Temp/RtmpQ7KJSR/mtcars20&#39;</span></span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a>✔ Creating <span class="st">&#39;data-raw/&#39;</span></span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a>✔ Creating <span class="st">&#39;data/&#39;</span></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a>✔ Creating <span class="st">&#39;inst/extdata/&#39;</span></span></code></pre></div>
<div id="whats-in-the-package-skeleton-structure" class="section level3">
<h3>What’s in the package skeleton structure?</h3>
<p>The process above has created a DataPackageR source tree named
“mtcars20” in a temporary directory. For a real use case, you would pick
a path on your file system where you could then initialize a new GitHub
repository for the package.</p>
<p>The contents of <code>mtcars20</code> are:</p>
<pre><code>                levelName
1  mtcars20              
2   ¦--DESCRIPTION       
3   ¦--R                 
4   ¦--Read-and-delete-me
5   ¦--data              
6   ¦--data-raw          
7   ¦   °--subsetCars.Rmd
8   ¦--datapackager.yml  
9   °--inst              
10      °--extdata       </code></pre>
<p>You should fill out the <code>DESCRIPTION</code> file to describe
your data package. It contains a new <code>DataVersion</code> string
that will be automatically incremented when the data package is built
<em>if the packaged data has changed</em>.</p>
<p>The user-provided code files reside in <code>data-raw</code>. They
are executed during the data package build process.</p>
</div>
<div id="a-note-about-the-yaml-config-file." class="section level3">
<h3>A note about the YAML config file.</h3>
<p>A <code>datapackager.yml</code> file is used to configure and control
the build process.</p>
<p>The contents are:</p>
<pre><code>configuration:
  files:
    subsetCars.Rmd:
      enabled: yes
  objects: cars_over_20
  render_root:
    tmp: &#39;954503&#39;</code></pre>
<p>The two main pieces of information in the configuration are a list of
the files to be processed and the data sets the package will store.</p>
<p>This example packages an R data set named <code>cars_over_20</code>
(the name was passed to <code>datapackage_skeleton()</code>), which is
created by the <code>subsetCars.Rmd</code> file.</p>
<p>The objects must be listed in the yaml configuration file.
<code>datapackage_skeleton()</code> ensures this is done for you
automatically.</p>
<p>DataPackageR provides an API for modifying this file, so it does not
need to be done by hand.</p>
<p>Further information on the contents of the YAML configuration file,
and the API are in the <a href="YAML_Configuration_Details.html">YAML
Configuration Details</a> vignette.</p>
</div>
<div id="where-do-i-put-my-raw-datasets" class="section level3">
<h3>Where do I put my raw datasets?</h3>
<p>Raw data (provided the size is not prohibitive) can be placed in
<code>inst/extdata</code>.</p>
<p>The <code>datapackage_skeleton()</code> API has the
<code>raw_data_dir</code> argument, which will copy the contents of
<code>raw_data_dir</code> (and its subdirectories) into
<code>inst/extdata</code> automatically.</p>
<p>In this example we are reading the <code>mtcars</code> data set that
is already in memory, rather than from the file system.</p>
</div>
<div id="an-api-to-read-raw-data-sets-from-within-an-r-or-rmd-processing-script." class="section level3">
<h3>An API to read raw data sets from within an R or Rmd processing
script.</h3>
<p>As stated in the README, in order for your processing scripts to be
portable, you should not use absolute paths to files. DataPackageR
provides an API to point to the data package root directory and the
<code>inst/extdata</code> and <code>data</code> subdirectories. These
are useful for constructing portable paths in your code to read files
from these locations.</p>
<p>For example, to construct a path to a file named “mydata.csv” located
in <code>inst/extdata</code> in your data package source tree:</p>
<ul>
<li>use <code>DataPackageR::project_extdata_path(&quot;mydata.csv&quot;)</code> in
your <code>R</code> or <code>Rmd</code> file. This would return: e.g.,
C:7KJSR/mtcars20/inst/extdata/mydata.csv</li>
</ul>
<p>Similarly:</p>
<ul>
<li><code>DataPackageR::project_path()</code> constructs a path to the
data package root directory. (e.g., C:7KJSR/mtcars20)</li>
<li><code>DataPackageR::project_data_path()</code> constructs a path to
the data package <code>data</code> subdirectory. (e.g.,
C:7KJSR/mtcars20/data)</li>
</ul>
<p>Raw data sets that are stored externally (outside the data package
source tree) can be constructed relative to the
<code>project_path()</code>.</p>
</div>
<div id="yaml-header-metadata-for-r-files-and-rmd-files." class="section level3">
<h3>YAML header metadata for R files and Rmd files.</h3>
<p>If your processing scripts are Rmd files, the usual yaml header for
rmarkdown documents should be present.</p>
<p>If your processing scripts are R files, you can still include a yaml
header, but it should be commented with <code>#&#39;</code> and it should be
at the top of your R file. For example, a test R file in the
DataPackageR package looks as follows:</p>
<pre><code>#&#39;---
#\&#39;title: Sample report from R script
#&#39;author: Greg Finak
#&#39;date: August 1, 2018
#&#39;---
data &lt;- runif(100)</code></pre>
<p>This will be converted to an Rmd file with a proper yaml header,
which will then be turned into a vignette and indexed in the built
package.</p>
</div>
</div>
<div id="build-the-data-package." class="section level2">
<h2>Build the data package.</h2>
<p>Once the skeleton framework is set up, run the preprocessing code to
build <code>cars_over_20</code>, and reproducibly enclose it in a
package.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>DataPackageR<span class="sc">::</span><span class="fu">package_build</span>(<span class="fu">file.path</span>(<span class="fu">tempdir</span>(),<span class="st">&quot;mtcars20&quot;</span>))</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>✔ <span class="dv">1</span> data <span class="fu">set</span>(s) created by subsetCars.Rmd</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>• cars_over_20</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>☘ Built all datasets<span class="sc">!</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>Non<span class="sc">-</span>interactive NEWS.md file update.</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="sc">*</span> Added<span class="sc">:</span> cars_over_20</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>✔ Creating <span class="st">&#39;vignettes/&#39;</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>✔ Creating <span class="st">&#39;inst/doc/&#39;</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>ℹ Loading mtcars20</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>Writing <span class="st">&#39;NAMESPACE&#39;</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>Writing <span class="st">&#39;mtcars20.Rd&#39;</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>Writing <span class="st">&#39;cars_over_20.Rd&#39;</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>── R CMD build ─────────────────────────────────────────────────────────────────</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>         checking <span class="cf">for</span> file <span class="st">&#39;C:\Users\dslager\AppData\Local\Temp\RtmpQ7KJSR\mtcars20/DESCRIPTION&#39;</span> ...  ✔  checking <span class="cf">for</span> file <span class="st">&#39;C:\Users\dslager\AppData\Local\Temp\RtmpQ7KJSR\mtcars20/DESCRIPTION&#39;</span> (<span class="dv">507</span>ms)</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>      ─  preparing <span class="st">&#39;mtcars20&#39;</span><span class="sc">:</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>   checking DESCRIPTION meta<span class="sc">-</span>information ...     checking DESCRIPTION meta<span class="sc">-</span>information ...   ✔  checking DESCRIPTION meta<span class="sc">-</span>information</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>      ─  checking <span class="cf">for</span> LF line<span class="sc">-</span>endings <span class="cf">in</span> source and make files and shell <span class="fu">scripts</span> (<span class="fl">1.1</span>s)</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>      ─  checking <span class="cf">for</span> empty or unneeded directories</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>      ─  looking to see <span class="cf">if</span> a <span class="st">&#39;data/datalist&#39;</span> file should be added</span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>      ─  building <span class="st">&#39;mtcars20_1.0.tar.gz&#39;</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>     </span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>Next Steps </span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a><span class="fl">1.</span> Update your package documentation. </span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a>   <span class="sc">-</span> Edit the documentation.R file <span class="cf">in</span> the package source data<span class="sc">-</span>raw subdirectory and update the roxygen markup. </span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a>   <span class="sc">-</span> Rebuild the package documentation with  <span class="fu">document</span>() . </span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a><span class="fl">2.</span> Add your package to source control. </span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a>   <span class="sc">-</span> Call  git init .  <span class="cf">in</span> the package source root directory. </span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a>   <span class="sc">-</span>  git add  the package files. </span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a>   <span class="sc">-</span>  git commit  your new package. </span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a>   <span class="sc">-</span> Set up a github repository <span class="cf">for</span> your pacakge. </span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a>   <span class="sc">-</span> Add the github repository as a remote of your local package repository. </span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a>   <span class="sc">-</span>  git push  your local repository to gitub. </span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;C:/Users/dslager/AppData/Local/Temp/RtmpQ7KJSR/mtcars20_1.0.tar.gz&quot;</span></span></code></pre></div>
<div id="documenting-your-data-set-changes-in-news." class="section level3">
<h3>Documenting your data set changes in NEWS.</h3>
<p>When you build a package in interactive mode, you will be prompted to
input text describing the changes to your data package (one line).</p>
<p>These will appear in the NEWS.md file in the following format:</p>
<pre><code>DataVersion: xx.yy.zz
========
A description of your changes to the package

[The rest of the file]</code></pre>
</div>
<div id="logging-the-build-process." class="section level3">
<h3>Logging the build process.</h3>
<p>DataPackageR uses the <code>futile.logger</code> package to log
progress.</p>
<p>If there are errors in the processing, the script will notify you via
logging to console and to
<code>/private/tmp/Test/inst/extdata/Logfiles/processing.log</code>.
Errors should be corrected and the build repeated.</p>
<p>If everything goes smoothly, you will have a new package built in the
parent directory.</p>
<p>In this case we have a new package:
<code>mtcars20_1.0.tar.gz</code>.</p>
</div>
<div id="a-note-about-the-package-source-directory-after-building." class="section level3">
<h3>A note about the package source directory after building.</h3>
<p>The package source directory changes after the first build.</p>
<pre><code>                         levelName
1  mtcars20                       
2   ¦--DATADIGEST                 
3   ¦--DESCRIPTION                
4   ¦--NAMESPACE                  
5   ¦--NEWS.md                    
6   ¦--R                          
7   ¦   °--mtcars20.R             
8   ¦--Read-and-delete-me         
9   ¦--data                       
10  ¦   °--cars_over_20.rda       
11  ¦--data-raw                   
12  ¦   ¦--documentation.R        
13  ¦   ¦--subsetCars.R           
14  ¦   °--subsetCars.Rmd         
15  ¦--datapackager.yml           
16  ¦--inst                       
17  ¦   ¦--doc                    
18  ¦   ¦   ¦--subsetCars.Rmd     
19  ¦   ¦   °--subsetCars.html    
20  ¦   °--extdata                
21  ¦       °--Logfiles           
22  ¦           ¦--processing.log 
23  ¦           °--subsetCars.html
24  ¦--man                        
25  ¦   ¦--cars_over_20.Rd        
26  ¦   °--mtcars20.Rd            
27  °--vignettes                  
28      °--subsetCars.Rmd         </code></pre>
</div>
<div id="update-the-auto-generated-documentation." class="section level3">
<h3>Update the auto-generated documentation.</h3>
<p>After the first build, the <code>R</code> directory contains
<code>mtcars.R</code> that has auto-generated <code>roxygen2</code>
markup documentation for the data package and for the
<code>cars_over20</code> packaged data.</p>
<p>The processed <code>Rd</code> files can be found in
<code>man</code>.</p>
<p>The auto-generated documentation source is in the
<code>documentation.R</code> file in <code>data-raw</code>.</p>
<p>You should update this file to properly document your objects. Then
rebuild the documentation:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>DataPackageR<span class="sc">::</span><span class="fu">document</span>(<span class="fu">file.path</span>(<span class="fu">tempdir</span>(),<span class="st">&quot;mtcars20&quot;</span>))</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>ℹ Loading mtcars20</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">TRUE</span></span></code></pre></div>
<p>Updating documentation does not reprocess the data.</p>
<p>Once the the documentation is updated in <code>R/mtcars.R</code>,
then run <code>package_build()</code> again.</p>
</div>
<div id="why-not-just-use-r-cmd-build" class="section level3">
<h3>Why not just use R CMD build?</h3>
<p>If the processing script is time consuming or the data set is
particularly large, then <code>R CMD build</code> would run the code
each time the package is installed. In such cases, raw data may not be
available, or the environment to do the data processing may not be set
up for each user of the data. DataPackageR decouples data processing
from package building/installation for data consumers.</p>
</div>
</div>
<div id="installing-and-using-the-new-data-package." class="section level2">
<h2>Installing and using the new data package.</h2>
<div id="accessing-vignettes-data-sets-and-data-set-documentation." class="section level3">
<h3>Accessing vignettes, data sets, and data set documentation.</h3>
<p>The package source also contains files in the <code>vignettes</code>
and <code>inst/doc</code> directories that provide a log of the data
processing.</p>
<p>When the package is installed, these will be accessible via the
<code>vignette()</code> API.</p>
<p>The vignette will detail the processing performed by the
<code>subsetCars.Rmd</code> processing script.</p>
<p>The data set documentation will be accessible via
<code>?cars_over_20</code>, and the data sets via
<code>data()</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># Create a temporary library to install into.</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">file.path</span>(<span class="fu">tempdir</span>(),<span class="st">&quot;lib&quot;</span>))</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co"># Let&#39;s install the package we just created.</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co"># This can also be done with with `install = TRUE` in package_build() or document().</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">file.path</span>(<span class="fu">tempdir</span>(),<span class="st">&quot;mtcars20_1.0.tar.gz&quot;</span>),</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>                 <span class="at">type =</span> <span class="st">&quot;source&quot;</span>, <span class="at">repos =</span> <span class="cn">NULL</span>,</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>                 <span class="at">lib =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(),<span class="st">&quot;lib&quot;</span>))</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>lns <span class="ot">&lt;-</span> loadNamespace</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">&quot;package:mtcars20&quot;</span><span class="sc">%in%</span><span class="fu">search</span>())</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>  <span class="fu">attachNamespace</span>(<span class="fu">lns</span>(<span class="st">&#39;mtcars20&#39;</span>,<span class="at">lib.loc =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(),<span class="st">&quot;lib&quot;</span>))) <span class="co">#use library() in your code</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;cars_over_20&quot;</span>) <span class="co"># load the data</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>cars_over_20 <span class="co"># now we can use it.</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>   speed dist</span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="dv">44</span>    <span class="dv">22</span>   <span class="dv">66</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="dv">45</span>    <span class="dv">23</span>   <span class="dv">54</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="dv">46</span>    <span class="dv">24</span>   <span class="dv">70</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a><span class="dv">47</span>    <span class="dv">24</span>   <span class="dv">92</span></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="dv">48</span>    <span class="dv">24</span>   <span class="dv">93</span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a><span class="dv">49</span>    <span class="dv">24</span>  <span class="dv">120</span></span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a><span class="dv">50</span>    <span class="dv">25</span>   <span class="dv">85</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>?cars_over_20 <span class="co"># See the documentation you wrote in data-raw/documentation.R.</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>vignettes <span class="ot">&lt;-</span> <span class="fu">vignette</span>(<span class="at">package =</span> <span class="st">&quot;mtcars20&quot;</span>, <span class="at">lib.loc =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(),<span class="st">&quot;lib&quot;</span>))</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>vignettes<span class="sc">$</span>results</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>      Package    LibPath                                             </span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>Topic <span class="st">&quot;mtcars20&quot;</span> <span class="st">&quot;C:/Users/dslager/AppData/Local/Temp/RtmpQ7KJSR/lib&quot;</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>      Item         Title                                            </span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>Topic <span class="st">&quot;subsetCars&quot;</span> <span class="st">&quot;A Test Document for DataPackageR (source, html)&quot;</span></span></code></pre></div>
</div>
<div id="using-the-dataversion." class="section level3">
<h3>Using the DataVersion.</h3>
<p>Your downstream data analysis can depend on a specific version of the
data in your data package by testing the DataVersion string in the
DESCRIPTION file.</p>
<p>We provide an API for this:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># We can easily check the version of the data.</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>DataPackageR<span class="sc">::</span><span class="fu">data_version</span>(<span class="st">&quot;mtcars20&quot;</span>, <span class="at">lib.loc =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(),<span class="st">&quot;lib&quot;</span>))</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&#39;0.1.0&#39;</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co"># You can use an assert to check the data version in  reports and</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co"># analyses that use the packaged data.</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="fu">assert_data_version</span>(<span class="at">data_package_name =</span> <span class="st">&quot;mtcars20&quot;</span>,</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>                    <span class="at">version_string =</span> <span class="st">&quot;0.1.0&quot;</span>, <span class="at">acceptable =</span> <span class="st">&quot;equal&quot;</span>,</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>                    <span class="at">lib.loc =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(),<span class="st">&quot;lib&quot;</span>))  <span class="co">#If this fails, execution stops</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>                                           <span class="co">#and provides an informative error.</span></span></code></pre></div>
</div>
</div>
<div id="migrating-old-data-packages." class="section level1">
<h1>Migrating old data packages.</h1>
<p>Version 1.12.0 has moved away from controlling the build process
using <code>datasets.R</code> and an additional <code>masterfile</code>
argument.</p>
<p>The build process is now controlled via a
<code>datapackager.yml</code> configuration file located in the package
root directory. See <a href="YAML_Configuration_Details.html">YAML
Configuration Details</a>.</p>
<div id="create-a-datapackager.yml-file." class="section level2">
<h2>Create a datapackager.yml file.</h2>
<p>You can migrate an old package by constructing such a config file
using the <code>construct_yml_config()</code> API.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># Assume I have file1.Rmd and file2.R located in /data-raw, and these</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co"># create &#39;object1&#39; and &#39;object2&#39; respectively.</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>config <span class="ot">&lt;-</span> <span class="fu">construct_yml_config</span>(<span class="at">code =</span> <span class="fu">c</span>(<span class="st">&quot;file1.Rmd&quot;</span>, <span class="st">&quot;file2.R&quot;</span>),</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>                               <span class="at">data =</span> <span class="fu">c</span>(<span class="st">&quot;object1&quot;</span>, <span class="st">&quot;object2&quot;</span>))</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="fu">cat</span>(yaml<span class="sc">::</span><span class="fu">as.yaml</span>(config))</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>configuration<span class="sc">:</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>  files<span class="sc">:</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>    file1.Rmd<span class="sc">:</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>      enabled<span class="sc">:</span> yes</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>    file2.R<span class="sc">:</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>      enabled<span class="sc">:</span> yes</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>  objects<span class="sc">:</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>  <span class="sc">-</span> object1</span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>  <span class="sc">-</span> object2</span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>  render_root<span class="sc">:</span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>    tmp<span class="sc">:</span> <span class="st">&#39;499488&#39;</span></span></code></pre></div>
<p><code>config</code> is a newly constructed yaml configuration object.
It can be written to the package directory:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>path_to_package <span class="ot">&lt;-</span> <span class="fu">tempdir</span>() <span class="co"># e.g., if tempdir() was the root of our package.</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="fu">yml_write</span>(config, <span class="at">path =</span> path_to_package)</span></code></pre></div>
<p>Now the package at <code>path_to_package</code> will build with
version 1.12.0 or greater.</p>
<div id="reading-data-sets-from-rmd-files." class="section level3">
<h3>Reading data sets from Rmd files.</h3>
<p>In versions prior to 1.12.1 we would read data sets from
<code>inst/extdata</code> in an <code>Rmd</code> script using paths
relative to <code>data-raw</code> in the data package source tree.</p>
<p>For example:</p>
<div id="the-old-way." class="section level4">
<h4>The old way.</h4>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># read &#39;myfile.csv&#39; from inst/extdata relative to data-raw where the Rmd is rendered.</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="fu">read.csv</span>(<span class="fu">file.path</span>(<span class="st">&quot;../inst/extdata&quot;</span>,<span class="st">&quot;myfile.csv&quot;</span>))</span></code></pre></div>
<p>Now <code>Rmd</code> and <code>R</code> scripts are processed in
<code>render_root</code> defined in the yaml config.</p>
<p>To read a raw data set we can get the path to the package source
directory using an API call:</p>
</div>
<div id="the-new-way." class="section level4">
<h4>The new way.</h4>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co"># DataPackageR::project_extdata_path() returns the path to the data package inst/extdata subdirectory directory.</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co"># DataPackageR::project_path() returns the path to the data package root directory.</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="co"># DataPackageR::project_data_path() returns the path to the data package data subdirectory directory.</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="fu">read.csv</span>(DataPackageR<span class="sc">::</span><span class="fu">project_extdata_path</span>(<span class="st">&quot;myfile.csv&quot;</span>))</span></code></pre></div>
</div>
</div>
</div>
</div>
<div id="partial-builds." class="section level1">
<h1>Partial builds.</h1>
<p>We can also perform partial builds of a subset of files in a package
by toggling the <code>enabled</code> key in the yaml config file.</p>
<p>This can be done with the following API:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>config <span class="ot">&lt;-</span> <span class="fu">yml_disable_compile</span>(config,<span class="at">filenames =</span> <span class="st">&quot;file2.R&quot;</span>)</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="fu">yml_write</span>(config, <span class="at">path =</span> path_to_package) <span class="co"># write modified yml to the package.</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>configuration<span class="sc">:</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>  files<span class="sc">:</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>    file1.Rmd<span class="sc">:</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>      enabled<span class="sc">:</span> yes</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>    file2.R<span class="sc">:</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>      enabled<span class="sc">:</span> no</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>  objects<span class="sc">:</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>  <span class="sc">-</span> object1</span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>  <span class="sc">-</span> object2</span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>  render_root<span class="sc">:</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>    tmp<span class="sc">:</span> <span class="st">&#39;499488&#39;</span></span></code></pre></div>
<p>Note that the modified configuration needs to be written back to the
package source directory in order for the changes to take effect.</p>
<p>The consequence of toggling a file to <code>enable: no</code> is that
it will be skipped when the package is rebuilt, but the data will still
be retained in the package, and the documentation will not be
altered.</p>
<p>This is useful in situations where we have multiple data sets, and we
want to re-run one script to update a specific data set, but not the
other scripts because they may be too time consuming.</p>
</div>
<div id="multi-script-pipelines." class="section level1">
<h1>Multi-script pipelines.</h1>
<p>We may have situations where we have multi-script pipelines. There
are two ways to share data among scripts.</p>
<ol style="list-style-type: decimal">
<li>file system artifacts</li>
<li>data objects passed to subsequent scripts</li>
</ol>
<div id="file-system-artifacts." class="section level2">
<h2>File system artifacts.</h2>
<p>The yaml configuration property <code>render_root</code> specifies
the working directory where scripts will be rendered.</p>
<p>If a script writes files to the working directory, that is where
files will appear. These can be read by subsequent scripts.</p>
</div>
<div id="passing-data-objects-to-subsequent-scripts." class="section level2">
<h2>Passing data objects to subsequent scripts.</h2>
<p>A script can access a data object designated to be packaged by
previously ran scripts using
<code>datapackager_object_read()</code>.</p>
<p>For example, <code>script2.Rmd</code> will run after
<code>script1.Rmd</code>. <code>script2.Rmd</code> needs to access a
data object that has been designated to be packaged named
<code>dataset1</code>, which was created by <code>script1.Rmd</code>.
This data set can be accessed by <code>script2.Rmd</code> using the
following expression:</p>
<p><code>dataset1 &lt;- DataPackageR::datapackager_object_read(&quot;dataset1&quot;)</code>.</p>
<p>Passing of data objects among scripts can be turned off via:</p>
<p><code>package_build(deps = FALSE)</code></p>
</div>
</div>
<div id="next-steps." class="section level1">
<h1>Next steps.</h1>
<p>We recommend the following once your package is created.</p>
<div id="place-your-package-under-source-control." class="section level2">
<h2>Place your package under source control.</h2>
<p>You now have a data package source tree.</p>
<ul>
<li><strong>Place your package under version control</strong>
<ol style="list-style-type: decimal">
<li>Call <code>git init</code> in the package source root to initialize
a new git repository.</li>
<li><a href="https://docs.github.com/articles/create-a-repo/">Create a
new repository for your data package on GitHub</a>.</li>
<li>Push your local package repository to <code>GitHub</code>. <a href="https://docs.github.com/articles/adding-an-existing-project-to-github-using-the-command-line/">see
step 7</a></li>
</ol></li>
</ul>
<p>This will let you version control your data processing code, and will
provide a mechanism for sharing your package with others.</p>
<p>For more details on using git and GitHub with R, there is an
excellent guide provided by Jenny Bryan: <a href="https://happygitwithr.com/">Happy git and GitHub for the useR</a>
and Hadley Wickham’s <a href="https://r-pkgs.org/">book on R
packages</a>.</p>
</div>
</div>
<div id="additional-details." class="section level1">
<h1>Additional Details.</h1>
<div id="fingerprints-of-stored-data-objects." class="section level2">
<h2>Fingerprints of stored data objects.</h2>
<p>DataPackageR calculates an md5 checksum of each data object it
stores, and keeps track of them in a file called
<code>DATADIGEST</code>.</p>
<ul>
<li>Each time the package is rebuilt, the md5 sums of the new data
objects are compared against <code>DATADIGEST</code>.</li>
<li>If they do not match, the build process checks that the
<code>DataVersion</code> string has been incremented in the
<code>DESCRIPTION</code> file.</li>
<li>If it has not, the build process will exit and produce an error
message.</li>
</ul>
<div id="datadigest" class="section level3">
<h3>DATADIGEST</h3>
<p>The <code>DATADIGEST</code> file contains the following:</p>
<pre><code>DataVersion: 0.1.0
cars_over_20: 3ccb5b0aaa74fe7cfc0d3ca6ab0b5cf3</code></pre>
</div>
<div id="description" class="section level3">
<h3>DESCRIPTION</h3>
<p>The description file has the new <code>DataVersion</code> string.</p>
<pre><code>Package: mtcars20
Title: What the Package Does (One Line, Title Case)
Version: 1.0
Authors@R: 
    person(&quot;First&quot;, &quot;Last&quot;, , &quot;first.last@example.com&quot;, role = c(&quot;aut&quot;, &quot;cre&quot;),
           comment = c(ORCID = &quot;YOUR-ORCID-ID&quot;))
Description: What the package does (one paragraph).
License: `use_mit_license()`, `use_gpl3_license()` or friends to pick a
    license
Encoding: UTF-8
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.3.1
DataVersion: 0.1.0
Depends: 
    R (&gt;= 3.5.0)
Date: 2024-06-02
Suggests: 
    knitr,
    rmarkdown
VignetteBuilder: knitr</code></pre>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
